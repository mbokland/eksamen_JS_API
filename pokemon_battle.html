<!DOC html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div class="main-container">
      <!--FIENDE-->
      <div class="enemy-health-container">
        <div class="healthbar-container">
          <div class="healthbar enemy-health"></div>
          <div class="text-container">
            <p id="enemy-name-txt">Fiendens navn</p>
            <p id="enemy-health-txt"></p>
          </div>
        </div>
      </div>

      <!--MIN POKEMON-->
      <div class="my-pokemon-health-container">
        <div class="healthbar-container">
          <div class="healthbar my-pokemon-health"></div>
          <div class="text-container">
            <p id="my-pokemon-name"></p>
            <p id="my-pokemon-health-txt"></p>
          </div>
        </div>
      </div>
      <!--Container med min pokemons attacks -->
      <div class="my-attack-container">
        <ul id="skills-list">
          <li class="skill-1">Skill 1</li>
          <li class="skill-2">Skill 2</li>
          <li class="skill-3">Skill 3</li>
          <li class="skill-4">Skill 4</li>
        </ul>
      </div>

      <!-- Bildenontainere fienden -->
      <div class="enemy-container">
        <div class="img-container enemy"></div>
      </div>
      <!-- Bildecontainer for min pokemon-->
      <div class="my-pokemon-container">
        <div class="img-container my-pokemon"></div>
      </div>
    </div>
    <script>
      const myPokemonContainer = document.querySelector(
        ".my-attacks-container"
      );

      async function fetchRandomPokemon() {
        console.log("Inne i fetchRandomPokemon");
        try {
          const randomPokemon = [];
          for (let i = 0; i < 3; i++) {
            const randomPokemonId = Math.floor(Math.random() * 400) + 1;
            const randomPokemonRequest = await fetch(
              "https://pokeapi.co/api/v2/pokemon/" + randomPokemonId
            );
            const randomPokemonData = await randomPokemonRequest.json();
            randomPokemon.push(randomPokemonData);
          }

          return randomPokemon;
        } catch {
          console.error("Feil ved innlastning av Random Pokemon!");
        }
      }

      async function fetchRandomPokemonData(pokemonId) {
        try {
          const pokemonDataRequest = await fetch(
            `https://pokeapi.co/api/v2/pokemon/${pokemonId}`
          );
          const data = await pokemonDataRequest.json();
          return data;
        } catch {
          console.error("Klarte ikke å hente Pokemons HP");
        }
      }

      async function addPokemonNameData() {
        try {
          const randomPokemon = await fetchRandomPokemon();

          const enemyData = await fetchRandomPokemonData(randomPokemon[0].id);
          const myPokemonData = await fetchRandomPokemonData(
            randomPokemon[1].id
          );

          const getHP = (pokemonData) => {
            return pokemonData.stats.find((stat) => stat.stat.name === "hp")
              .base_stat;
          };

          const enemyHP = getHP(enemyData);
          const myPokemonHP = getHP(myPokemonData);

          document.querySelector("#enemy-name-txt").innerHTML =
            randomPokemon[0].name;
          document.querySelector(
            "#enemy-health-txt"
          ).innerHTML = `HP: ${enemyHP}`;
          document.querySelector("#my-pokemon-name").innerHTML =
            randomPokemon[1].name;
          document.querySelector(
            "#my-pokemon-health-txt"
          ).innerHTML = `HP: ${myPokemonHP}`;
        } catch (error) {
          console.error("Feil ved oppdatering av navn på Pokemon"), error;
        }
      }

      async function fetchPokemonImg() {
        try {
          const randomPokemonData = await fetchRandomPokemon();
          const enemyId = randomPokemonData[0].id;
          const myPokemonId = randomPokemonData[1].id;

          const enemyImgUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${enemyId}.png`;

          const myPokemonImgUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${myPokemonId}.png`;

          const enemyContainer = document.querySelector(
            ".enemy-container .img-container.enemy"
          );
          enemyContainer.innerHTML = `<img src="${enemyImgUrl}" alt="Fiendens bilde">`;

          const myPokemonContainer = document.querySelector(
            ".my-pokemon-container .img-container"
          );
          myPokemonContainer.innerHTML = `<img src="${myPokemonImgUrl}" alt="Din Pokemons bilde">`;
        } catch (error) {
          console.error("Feil ved lasting av bilde", error);
        }
      }

      async function showPokemonImages() {
        try {
          await fetchPokemonImg();
        } catch (error) {
          console.error("Kunne ikke laste inn bilder", error);
        }
      }

      showPokemonImages();
      addPokemonNameData();
    </script>
  </body>
</html>
