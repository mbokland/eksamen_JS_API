<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eksamen i Javascript og API</title>
  </head>
  <body>
    <h1>Pokemonoversikt</h1>
    <button id="clear-filter">Fjern filter</button>
    <div id="filter-buttons"></div>
    <div id="show-all-pokemon"></div>
    <div id="pokemon-container"></div>

    <script>
      //Her hentes div ifra HTML
      const showAllPokemon = document.querySelector("#show-all-pokemon");

      //Fetcher APIet's pokemon (etter anvist i dokumentasjonen)
      async function fetchPokemon() {
        try {
          const pokemonRequest = await fetch(
            "https://pokeapi.co/api/v2/pokemon/?limit=50"
          );

          let result = await pokemonRequest.json();

          //ForEach går gjennom results-arrayet //Tar imot Pokemonobjekt til parameter
          //Fetcher alle pokemons
          //Gjør om til json-format, await=venter til data er lastet opp
          result.results.forEach(async (pokemon) => {
            const pokemonRequest = await fetch(pokemon.url);
            const pokemonData = await pokemonRequest.json();

            //Henter pokemon sin nummer-id, for å knytte opp mot ekstern bildedatabase
            const pokemonNumber = pokemonData.id;

            //Link til pokeAPIets github med bilderessurser
            const pokemonImageUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemonNumber}.png`;

            //lager ny div med informasjonen fra APIet
            //pokemonData.name brukes for å få opp navnet, types for å få typen. Bruke array 0 for å få første typen, ikke alle.
            const pokemonCard = document.createElement("div");
            pokemonCard.innerHTML = `
                <p>Navn: ${pokemonData.name}</p>
                <p>Type: ${pokemonData.types[0].type.name}</p>`;

            //legge til nytt element(bilde)
            const imgCard = document.createElement("img");
            imgCard.src = pokemonImageUrl;
            pokemonCard.appendChild(imgCard);

            //legge til knapper i pokemonCard
            const saveBtn = document.createElement("button");
            saveBtn.textContent = "Lagre";
            saveBtn.style.width = "50px";

            const deleteBtn = document.createElement("button");
            deleteBtn.textContent = "Slett";
            deleteBtn.style.width = "50px";

            const editBtn = document.createElement("button");
            editBtn.textContent = "Endre";
            editBtn.style.width = "50px";

            pokemonCard.appendChild(saveBtn);
            pokemonCard.appendChild(deleteBtn);
            pokemonCard.appendChild(editBtn);

            //appendChild for å lage underelement av ShowAllPokemon, og funksjonen gjør at info vises på nettsiden.
            showAllPokemon.appendChild(pokemonCard);
          });
        } catch {
          console.error("Oisann! Klarte ikke å laste inn Pokémon!");
        }
      }

      //kalle på funksjonen
      fetchPokemon();

      //FILTER

      let allPokemonTypes = [];

      async function fetchPokemonTypes() {
        try {
          const fetchTypesRequest = await fetch(
            "https://pokeapi.co/api/v2/type"
          );
          const pokemonTypeData = await fetchTypesRequest.json();
          allPokemonTypes = pokemonTypeData.results;
          const pokemonTypes = pokemonTypeData.results.slice(0, 18);
          createFilterBtn(pokemonTypes);
        } catch (error) {
          console.error("Feil ved lasting av type Pokemon", error);
        }
      }

      function createFilterBtn(pokemonTypes) {
        const filterBtnContainer = document.getElementById("filter-buttons");

        filterBtnContainer.innerHTML = ""; //Tømmer btn-container, så ikke knappene dobler seg

        pokemonTypes.forEach((type) => {
          const pokemonTypeBtn = document.createElement("button");
          pokemonTypeBtn.textContent = type.name;
          pokemonTypeBtn.addEventListener("click", () => {
            fetchPokemonTypes(type.name);
          });
          filterBtnContainer.appendChild(pokemonTypeBtn);
        });
      }

      async function fetchPokemonByType(type) {
        try {
          const response = await fetch(
            `https://pokeapi.co/api/v2/type/${type}`
          );
          const pokemonTypeData = await response.json();
          const pokemons = pokemonTypeData.pokemon;

          showAllPokemon.innerHTML = ""; //sletter ordinære 50 pokemons når fetchPokemonByType blir kalt
          await displayFilteredPokemons(pokemons);
        } catch (error) {
          console.error("Klarte ikke å laste inn pokemon av type ${}", error);
        }
      }

      function displayFilteredPokemons(pokemon) {}

      fetchPokemonTypes();
    </script>
  </body>
</html>
